---
title: "Sleep Health and Lifestyle"
author: "Mert Baki Dogan"
date: "`r Sys.Date()`"
format: 
  html: 
    toc: true
    toc_float: true
    embed-resources: true
    code-fold: true
    code-summary: "Code anzeigen"
---

```{r = packets, include=FALSE}
library(tidyverse)
library(tidymodels)
library(explore)
library(ranger)
library(corrplot)
```

# Aufgabenstellung und Daten verstehen

In dieser Arbeit soll untersucht werden, wie sich verschiedene Faktoren auf die Schlafqualität auswirken. Dabei geht es nicht nur darum, ob sich diese Faktoren auswirken, sondern auch, wie stark ihr Einfluss ist. Anschließend soll ein regressives Machine-Learning-Modell entwickelt werden, das die Schlafqualität vorhersagt.

Dazu steht uns der Datensatz *Sleep Health and Lifestyle Dataset* zur Verfügung. Dieser Datensatz enthält Informationen über den Lebensstil und die Schlafqualität verschiedener Personen. Er ist unter folgendem Link zu finden: <https://www.kaggle.com/datasets/uom190346a/sleep-health-and-lifestyle-dataset>

Zu Beginn formulieren wir zwei Thesen, die wir mit Hilfe des Datensatzes überprüfen möchten.

**These 1: Wenig Stress und viel körperliche Aktivität haben einen großen Einfluss auf eine gute Schlafqualität**

**These 2: Mit dem Alter nimmt die Schlafqualität ab**

Diese Thesen sollen explorativ untersucht werden und kommen eventuell in der Modellfindung zum Einsatz. Weitere Thesen werden sich eventuell bei der Sichtung der Daten ergeben.

Im nächsten Schritt werden die Daten eingelesen.

```{r}
sleep_data <- read.csv("Sleep_health_and_lifestyle_dataset.csv")
```

Schauen wir uns die Daten zunächst einmal an.

```{r, message=FALSE}
knitr::kable(head(sleep_data), caption = "Das Spaltenformat des eingelesenen Datensatzes")
```

Der Datensatz hat **`r nrow(sleep_data)`** Zeilen und **`r ncol(sleep_data)`** Spalten.

Die Variablen haben folgende Bedeutung:

| Variable | Type | Bedeutung |
|------------------------|------------------------|------------------------|
| Person.ID | int | Kennung für jede Person |
| Gender | chr | Geschlecht ("Male"/"Female") |
| Age | int | Alter |
| Occupation | chr | Beruf |
| Sleep.Duration | dbl | Anzahl der Stunden, die die Person am Tag schläft |
| Quality.of.Sleep | int | Subjektive Bewertung der Schlafqualität (1-10) |
| Physical.Activity.Level | int | Tägliche Aktivität in Minuten |
| Stress.Level | int | Subjektive Bewertung des Stresslevels (1-10) |
| BMI.Category | chr | BMI Kategorie |
| Blood.Pressure | char | Blutdruck (systolisch/diastolisch) |
| Heart.Rate | int | Ruheherzfrequenz |
| Daily.Steps | int | Tägliche Schritte |
| Sleep.Disorder | chr | Schlafstörung (Keine, Insomnie, Schlafapnoe) |

Zunächst verschaffen wir uns einen Überblick über die Daten.

```{r}
glimpse(sleep_data)
```

```{r, message=FALSE}
sleep_data %>% describe()
sleep_data %>% describe_tbl()
```

*Person.ID* nummeriert lediglich die verschiedenen Personen durch und ist deshalb für uns nicht relevant. Auch die Variable *Occupation* liefert uns keine relevanten Informationen. Aus diesem Grund werden wir *Person.ID* und *Occupation* später aus dem Datensatz entfernen.

Die restlichen Variablen könnten einen Einfluss auf die Schlafqualität haben. Auch wenn wir nicht alle in der explorativen Datenanalyse verwenden, könnten sie uns trotzdem später beim Trainieren des Modells helfen.

```{r}
summary(sleep_data)
```

Wenn wir uns die Summary anschauen, können wir keine Auffälligkeiten feststellen. Alle Daten wirken realistisch.

# Daten aufbereiten

Erstellen wir unseren finalen Datensatz und entfernen die Variablen *Person.ID* und *Occupation*, da diese für unseren Kontext nicht relevant sind.

```{r, message=FALSE}
final_sleep_data <- 
  sleep_data %>% 
  select(-Person.ID, -Occupation)
```

Das Geschlecht ist eine kategorische Variable. Wandeln wir sie für eine einfachere Weiterverarbeitung in einen Faktor um.

```{r, message=FALSE}
final_sleep_data$Gender <-
  as.factor(final_sleep_data$Gender)
```

Da für uns nicht relevant ist, um welche Schlafstörung es sich genau handelt, geben wir nur an, ob eine Schlafstörung vorhanden ist.

```{r, message=FALSE}
final_sleep_data <- 
  final_sleep_data %>% 
  mutate(Sleep.Disorder = Sleep.Disorder != "None")
```

Um die Lesbarkeit zu verbessern, wandeln wir die *Sleep.Disorder* Variable, in zwei Kategorien um.

```{r, message=FALSE}
final_sleep_data$Sleep.Disorder <-
  if_else(final_sleep_data$Sleep.Disorder, "Hat Schlafstörung", "Hat keine Schlafstörung") %>%
  as_factor()
```

Um die Weiterverarbeitung zu vereinfachen, wandeln wir die *BMI.Category* zu einem Faktor um. Dabei beachten wir aber auch die Reihenfolge der Kategorien.

Dazu schauen wir uns erst einmal an, welche Kategorien in *BMI.Category* enthalten sind.

```{r, message=FALSE}
unique(final_sleep_data$BMI.Category)
```

Die Kategorien *Normal* und *Normal Weight* scheinen dieselben zu sein. Also ersetzen wir *Normal* mit *Normal Weight*.

```{r}
final_sleep_data <- final_sleep_data %>%
  mutate(BMI.Category = replace(BMI.Category, BMI.Category == "Normal", "Normal Weight"))

unique(final_sleep_data$BMI.Category)
```

Das ergibt 3 Kategorien. Sortiert werden die Kategorien: *"Normal Weight" \< "Overweight" \< "Obese"*

```{r, message=FALSE}
final_sleep_data$BMI.Category <-
  final_sleep_data$BMI.Category %>%
  factor(
    levels = c("Normal Weight","Overweight", "Obese"),
    ordered = TRUE
    )

unique(final_sleep_data$BMI.Category)
```

Die Variable *Blood.Pressure* ist als String im Datensatz. Wir teilen die Variable in den systolischen und diastolischen Wert auf und wandeln sie in einen Integer um.

```{r}
final_sleep_data <-
  final_sleep_data %>%
  separate_wider_delim(
    Blood.Pressure,
    delim = "/",
    names = c("BD.Systolisch", "BD.Diastolisch"),
  ) %>%
  mutate(
    BD.Systolisch = as.integer(BD.Systolisch),
    BD.Diastolisch = as.integer(BD.Diastolisch)
  )
```

Am Ende werfen wir noch einen kurzen Blick in den finalen Datensatz.

```{r}
knitr::kable(head(final_sleep_data), caption = "Der finale Datensatz")
```

Nachdem wir den Datensatz fertig aufbereitet haben, widmen wir uns unserer ersten These.

# Modell bilden

## Testdaten beiseitelegen

Damit sich keine Data-Snooping-Bias entwickelt, legen wir bereits am Anfang einen Teil der Daten beiseite. Diese werden wir dann am Ende dazu verwenden, um das Modell auf noch nicht gesehene Daten zu testen.

```{r}
set.seed(1337)
sleep_data_split <- initial_split(final_sleep_data, prop = 0.80, Quality.of.Sleep)
sleep_data_split
```

```{r}
final_sleep_data_train <- training(sleep_data_split)
final_sleep_data_test <- testing(sleep_data_split)
final_sleep_data <- final_sleep_data_train
```

## Explorative Datenanalyse

### Untersuchung der ersten These

Zunächst untersuchen wir, wie sich Stress auf die Schlafqualität auswirkt. Dabei vergleichen wir die Variable *Stress.Level* mit der Variable *Quality.of.Sleep*.

```{r, message=FALSE}
ggplot(
  data = final_sleep_data,
  mapping = aes(x = Stress.Level, y = Quality.of.Sleep)
) +
  geom_smooth() +
  geom_count() +
  labs(
    title = "Stress und Schlafqualität",
    x = "Stresslevel (1 - 10)", 
    y = "Schlafqualität (1 - 10)"
  )
```

Die Grafik zeigt, dass die Schlafqualität mit zunehmendem Stress abnimmt. Sie hat eine starke negative Korrelation von **`r cor(final_sleep_data$Stress.Level, final_sleep_data$Quality.of.Sleep)`**

Die Schlafqualität bleibt in einem Bereich von 4 bis 9. Wobei der Durchschnitt **`r mean(final_sleep_data$Quality.of.Sleep)`** beträgt.

Bis zu einem Stresslevel von 6 bleibt die Schlafqualität somit über dem Durchschnitt. Befindet sich also relativ zum Datensatz im höheren Bereich. Ab einem Stresslevel von 6 fällt die Schlafqualität hingegen unter dem Durchschnitt.

Dabei ist zu beachten, dass es sich um subjektive Daten handelt. Um ein genaueres Bild zu erhalten, betrachten wir im Folgenden, wie sich Stress auf die Schlafstörungen auswirkt. Dazu betrachten wir, wie groß der Anteil der Personen ist, die an Schlafstörungen leiden.

```{r}
stress_sleep_dis <- final_sleep_data %>%
  group_by(Stress.Level) %>%
  summarise(
    percent_sleep_disorder = sum(Sleep.Disorder == "Hat Schlafstörung") / (sum(Sleep.Disorder == "Hat keine Schlafstörung") + sum(Sleep.Disorder == "Hat Schlafstörung"))
  )

stress_sleep_dis %>%
  ggplot(mapping = aes(x = Stress.Level, y = percent_sleep_disorder)) +
  geom_col() +
  scale_x_continuous(breaks = 1:10) +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Stress und Schlafstörungen",
    subtitle = "Anzahl der Schlafstörung relativ zu den gesamten Personen",
    x = "Stresslevel (1 - 10)",
    y = "Schlafstörungen Anteil in %"
  )
```

Wie zu erkennen ist, liegt der Anteil der Schlafstörungen bei einem Stresslevel von 1 bis 6 unter 50 Prozent. Man kann sogar einen Abfall der Schlafstörungen bis zu einem Stresslevel von 6 erkennen. Ab dem Stresslevel von 6 steigt der Anteil der Schlafstörungen jedoch deutlich an.

Trotz des anfänglichen Rückgangs kann man sagen, dass ein höheres Stresslevel mit einem erhöhten Auftreten von Schlafstörungen einhergeht.

Damit bestätigen sich die vorherigen Ergebnisse und man kann sagen:

**Weniger Stress wirkt sich positiv auf die Schlafqualität aus**

Schauen wir uns als nächstes an, wie sich körperliche Aktivität auf die Schlafqualität auswirkt.

```{r, message=FALSE}
final_sleep_data %>%
  ggplot(
    mapping = aes(x = Physical.Activity.Level, y = Quality.of.Sleep)
  ) +
  geom_smooth() +
  geom_count(mapping = aes(color = Stress.Level)) +
  scale_x_continuous(breaks = seq(0, 100, by = 10)) +
  labs(
    title = "Körperliche Aktivität, Schlafqualität und Stress",
    x = "Tägliche körperliche Aktivität in Minuten", 
    y = "Schlafqualität (1 - 10)",
    color = "Stresslevel"
  )
```

Es zeigt sich kein eindeutiger Zusammenhang zwischen körperlicher Aktivität und Schlafqualität. Es lässt sich jedoch ein leichter Anstieg erkennen. Die Korrelation ist leicht positiv und liegt bei **`r cor(final_sleep_data$Physical.Activity.Level, final_sleep_data$Quality.of.Sleep)`**

Zudem sind zwei größere Ausreißer sichtbar. Einen bei guter Schlafqualität trotz körperlicher Aktivität und einen bei schlechter Schlafqualität trotz hoher körperlicher Aktivität. Diese haben jedoch ein hohes und niedriges Stresslevel. Die Schlafqualität ist in diesen Fällen also vom Stresslevel beeinflusst.

**Insgesamt deutet die Analyse darauf hin, dass Stress einen stärkeren Einfluss auf die Schlafqualität hat als die körperliche Aktivität.**

Trotzdem scheint auch die körperliche Aktivität einen leichten Einfluss auf die Schlafqualität zu haben.

Um ein noch genaueres Bild zu erhalten, betrachten wir im Folgenden die Verteilung der Schlafstörungen auf die körperliche Aktivität.

```{r}
final_sleep_data %>%
  ggplot(
    mapping = aes(x = Physical.Activity.Level, y = Sleep.Disorder)
  ) +
  geom_violin() +
  scale_x_continuous(breaks = seq(0, 100, by = 10)) +
  theme(axis.title.y = element_blank()) +
  labs(
    title = "Schlafstörung und Körperliche Aktivität",
    x = "Tägliche Körperliche Aktivität in Minuten"
  )
```

Die Daten weisen insgesamt eine hohe Spannweite auf. Es ist jedoch eine deutliche Häufung von Personen mit Schlafstörungen im Bereich geringer täglicher körperlicher Aktivität zu erkennen.

Dies korrespondiert mit dem vorherigen Darstellungen und stützt die Annahme, dass mehr körperliche Aktivität die Schlafqualität positiv beeinflusst.

Um den Zusammenhang zwischen körperlicher Aktivität und der Schlafqualität zu untersuchen, schauen wir uns noch die tägliche Schrittzahl an. Die Schrittzahl dient hierbei als weiterer Indikator für die körperliche Aktivität.

```{r message=FALSE, warning=FALSE}
final_sleep_data %>%
  ggplot(
    mapping = aes(x = Daily.Steps, y = Quality.of.Sleep)
  ) +
  geom_smooth(method = "lm") +
  geom_count(mapping = aes(color = Stress.Level)) +
  labs(
    title = "Tägliche Schritte und Schlafqualität",
    x = "Tägliche Schritte", 
    y = "Schlafqualität (1 - 10)",
    color = "Stresslevel"
  )
```

Die Schrittzahl zeigt keinen eindeutigen Zusammenhang zur Schlafqualität. Der stärkere Auslöser scheint auch hier das Stresslevel zu sein.

Zusätzlich vergleichen wir, ob die Anzahl der täglichen Schritte einen Zusammenhang mit Schlafstörungen hat.

```{r}
final_sleep_data %>%
  ggplot(
    mapping = aes(x = Daily.Steps, y = Sleep.Disorder)
  ) +
  geom_violin() +
  theme(axis.title.y = element_blank()) +
  labs(
    title = "Schlafstörung und Tägliche Schritte",
    x = "Tägliche Schritte"
  )
```



Ähnlich wie im Diagramm *Schlafstörungen und körperliche Aktivität* weisen Personen ohne Schlafstörung eine größere Spannweite. Zudem kann man nur leicht erkennen, dass ein Großteil der Personen mit Schlafstörung weniger tägliche Schritte haben, also die Personen ohne eine Schlafstörung.

**Somit kann man aus den Diagrammen schlussfolgern, dass die körperliche Aktivität einen leichten Einfluss auf die Schlafqualität hat.**

Somit lässt sich die These nur zum Teil bestätigen. Wenig Stress hat einen großen Einfluss auf die Schlafqualität. Dagegen hat die körperliche Aktivität nur einen leichten Einfluss auf die Schlafqualität.

### Untersuchung der zweiten These

Zunächst werfen wir einen Blick auf den Zusammenhang zwischen Alter und der Schlafqualität.

```{r, message=FALSE, warning=FALSE}
ggplot(
  data = final_sleep_data,
  mapping = aes(x = Age, y = Quality.of.Sleep)
) + 
  geom_smooth() +
  geom_count() +
  labs(
    title = "Alter und Schlafqualität",
    x = "Alter", y = "Schlafqualität"
  )
```

In der Grafik ist erkennbar, dass die Schlafqualität mit zunehmendem Alter ansteigt. Sie steigt aber nicht linear. Im Bereich vom Alter 37 bis zum Alter 47 gibt es einen Rückgang der Schlafqualität.

Somit ergibt sich eine leicht positive Korrelation von **`r cor(final_sleep_data$Quality.of.Sleep, final_sleep_data$Age)`**.

Schauen wir uns ergänzend dazu noch an, wie sich das Alter auf die Schlafstörungen auswirkt.

```{r}
ggplot(
  data = final_sleep_data,
  mapping = aes(x = Age, y = Sleep.Disorder)
) +
  geom_boxplot()
```

Der Graph zeigt, dass Schlafstörungen häufiger im hohen Alter auftreten. Dieses Ergebnis steht im Kontrast zum vorherigen Graphen, der einen Anstieg der Schlafqualität mit zunehmendem Alter zeigt.

Dabei ist jedoch zu berücksichtigen, dass es sich hierbei um eine schwach positive Korrelation handelt. Zudem ist die Schlafqualität eine subjektive Variable. Darüber hinaus verläuft die Entwicklung nicht linear, sondern sinkt zwischendurch.

Alles in allem kann man also sagen, dass der zweite Graph eindeutigere Ergebnisse liefert. Somit wird die am Anfang aufgestellte These widerlegt: Schlafqualität scheint im Alter schlechter zu werden. Jedoch kann man nicht sagen, dass dies ein eindeutiges Ergebnis ist, da sich die Graphen teilweise widersprechen.

Um ein genaueres Ergebnis zu erhalten, müsste man sich noch weitere Daten anschauen – insbesondere die Daten, die im hohen Alter eine gute Schlafqualität aufweisen, da dies dem zweiten Graphen widerspricht. Man könnte also versuchen, die widersprüchlichen Daten durch andere Faktoren zu interpretieren.

## Daten aufbereiten

Bereiten wir die Daten final auf, um einen trainingsbereiten Datensatz zu erhalten.

```{r}
rec <- recipe(Quality.of.Sleep ~ ., data = final_sleep_data_train) %>%
  step_impute_median(all_numeric_predictors()) %>%
  step_dummy(all_nominal_predictors()) %>%
  step_normalize(all_predictors()) 

prep_rec <- prep(rec)

train_ready <- bake(prep_rec, new_data = NULL)

train_ready
```

## Modellieren

### Lineare Regression

Trainieren wir zuerst ein **lineares Regressionsmodell**

```{r}
lm_model <- linear_reg() %>% 
  set_engine("lm")

lm_fit <- lm_model %>% 
  fit(Quality.of.Sleep ~ ., data = train_ready)

lm_fit %>% 
  extract_fit_engine() %>% 
  summary()
```

Schauen wir uns die Fehler der Vorhersage auf dem gesamten Trainingsdatensatz an.

```{r, warning=FALSE}
pred_lm <- predict(lm_fit, new_data = train_ready)

compare_lm <- train_ready %>% 
  select(Quality.of.Sleep) %>% 
  bind_cols(pred_lm)

head(compare_lm)
```

Nun berechnen wir anhand der Ergebnisse den RMSE Wert.

```{r}
rmse(compare_lm, Quality.of.Sleep, .pred)
```

Dieser liegt in einem guten Bereich. Somit scheinen die Vorhersagen vom eigentlichen Wert nicht allzu stark abzuweichen.

Zudem führen wir hier noch eine Kreuzvalidierung durch, um potenzielles Overfitting auszuschließen und die Performance des Modells besser herauszufinden.

```{r}
cv_splits <- vfold_cv(train_ready, v = 10, strata = Quality.of.Sleep)

lm_model <- linear_reg() %>% 
  set_engine("lm")

workflow_spec <- workflow() %>%
  add_model(lm_model) %>%
  add_formula(Quality.of.Sleep ~ .)

cv_results <- 
  workflow_spec %>% 
  fit_resamples(resamples = cv_splits, 
                control = control_resamples(save_pred = TRUE))

cv_results %>% collect_metrics()
```

Der RMSE Wert hat sich nur leicht verschlechtert, somit können wir Overfitting ausschließen

Um zu schauen ob ein anderes Modell noch besser performen kann, schauen wir uns ein weiteres Modell an.

### Entscheidungsbaum

Als nächstes schauen wir und das **Entscheidungsbaum** Modell an.

```{r}
tree_mod <- decision_tree(mode = "regression") 

tree_fit <- tree_mod %>% 
  fit(Quality.of.Sleep ~ ., data = train_ready)
```

Betrachten wir auch hier die Fehler der Vorhersage auf dem gesamten Trainingsdatensatz.

```{r}
pred_tree <- predict(tree_fit, new_data = train_ready)

compare_tree <- train_ready %>% 
  select(Quality.of.Sleep) %>%
  bind_cols(pred_tree)

head(compare_tree)
```

```{r}
rmse(compare_tree, Quality.of.Sleep, .pred)
```

Der RMSE Wert fällt besser aus, als der RMSE vom *Linearen Regressions* Modell, somit scheint das Modell erstmal besser zu performen.

Aber auch hier führen wir zudem noch eine Kreuzvalidierung durch.

```{r}
cv_splits <- vfold_cv(train_ready, v = 10, strata = Quality.of.Sleep)

model_spec <- decision_tree() %>%
  set_mode("regression")

workflow_spec <- workflow() %>%
  add_model(model_spec) %>%
  add_formula(Quality.of.Sleep ~ .)

cv_results <- 
  workflow_spec %>% 
  fit_resamples(resamples = cv_splits, 
                control = control_resamples(save_pred = TRUE))

cv_results %>% collect_metrics()
```

Die Kreuzvalidierung ergibt einen höheren RMSE Wert. Dieser ist ähnlich hoch wie der RMSE Wert der linearen Regression.

Somit versuchen wir es mit einem weiteren Modell.

### Random Forest

Trainieren wir also das **Random Forest** Modell.

```{r}
forest_mod <- rand_forest(trees = 1000)  %>%  
    set_mode("regression") 

forest_fit <- forest_mod %>% 
  fit(Quality.of.Sleep ~ ., data = train_ready)
```

Schauen wir uns die Fehler der Vorhersage auf dem gesamten Trainingsdatensatz an.

```{r}

pred_forest <- predict(forest_fit, new_data = train_ready)

compare_forest <- train_ready %>% 
  select(Quality.of.Sleep) %>%
  bind_cols(pred_forest)

head(compare_forest)
```

```{r}
rmse(compare_forest, Quality.of.Sleep, .pred)
```

Hier haben wir den geringsten RMSE Wert von allen bisher verwendeten Modellen.

Um ein potenzielles Overfitten auszuschließen führen wir auch hier eine Kreuzvalidierung durch.

```{r}
cv_splits <- vfold_cv(train_ready, v = 10, strata = Quality.of.Sleep)

model_spec <- rand_forest(trees = 1000) %>%
  set_mode("regression")

workflow_spec <- workflow() %>%
  add_model(model_spec) %>%
  add_formula(Quality.of.Sleep~.)

cv_results <- 
  workflow_spec %>% 
  fit_resamples(resamples = cv_splits, 
                control = control_resamples(save_pred = TRUE))

cv_results %>% collect_metrics()
```

Der RMSE Wert ist nur leicht höher als der vorherige und fällt im Gegensatz zu den vorherigen Modellen immer noch am geringsten aus.

Alles in allem performt also das **Random Forest** Modell am besten. Somit werden wir dies auch verwenden.

## Modelle optimieren

Nun optimieren wir das **Random Forest** Modell noch.

Wir verwenden dazu ein reguläres Grid um die beste Kombination der Parameter **mtry** und **min_n** zu finden.

```{r}
# Quelle: [1]
forest_mod <- rand_forest(mtry = tune(), min_n = tune(), trees = 1000)  %>%  
    set_mode("regression") 

forest_folds <- vfold_cv(final_sleep_data_train, strata = Quality.of.Sleep)

forest_wflow <- workflow() %>%
  add_model(forest_mod) %>%
  add_recipe(rec)
  
forest_param <- forest_wflow %>% 
  extract_parameter_set_dials() %>%
  update(
    mtry = mtry(c(1, 12))
  )

forest_tune <- forest_wflow %>%
  tune_grid(
    forest_folds,
    grid = forest_param %>% grid_regular(levels = 3),
    metrics = metric_set(rmse)
  )

best_param <- select_best(forest_tune, metric = "rmse")

best_param
```

Mit den Parametern trainieren wir ein optimiertes Random Forest Modell.

```{r}
final_forest_mod <- rand_forest(mtry = best_param$mtry, min_n = best_param$min_n, trees = 1000)  %>%
    set_mode("regression") 

final_forest_fit <- final_forest_mod %>% 
  fit(Quality.of.Sleep ~ ., data = train_ready)
```

## Modell beurteilen

Baken wir den Testdatensatz zuerst um unseren finalen Testdatensatz zu bekommen.

```{r}
test_ready <- bake(prep_rec, new_data = final_sleep_data_test)
```

Nun testen wir unser Modell mit dem fertigen Testdatensatz.

```{r}
pred_test <- predict(final_forest_fit, new_data = test_ready)

compare_test <- final_sleep_data_test %>% 
  select(Quality.of.Sleep) %>% 
  bind_cols(pred_test)

head(compare_test)
```

Schauen wir uns final noch den RMSE Wert an.

```{r}
rmse(compare_test, Quality.of.Sleep, .pred)
```

Dieser liegt in einem niedrigen Bereich.

# Evaluieren

Allem im allem kann man sagen, dass das Modell *Random Forest* am besten bei diesem Datensatz performt. Dies konnten wir durch das Vergleichen der RMSE Werte festlegen.

Durch das tunen der Parameter *mtry* und *min_n* konnten wir die Performance noch verbessern. Somit haben wir am Ende ein gut performendes Modell mit dem sich gut weiterarbeiten lässt.

Natürlich ist der Datensatz noch klein, somit müsste man das Modell auch mit mehr Daten testen um ein genaueres Ergebnis zu bekommen. Auch die Schlussfolgerung der Explorativen Datenanalyse würde durch mehr Daten und das einbeziehen von mehr Variablen ein eindeutigeres Ergebnis liefern.

# Quellen

\[1\] <https://www.tmwr.org/grid-search>
