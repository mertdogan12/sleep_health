---
title: "Sleep Health and Lifestyle"
author: "Mert Baki Dogan"
date: "`r Sys.Date()`"
format: 
  html: 
    toc: true
    toc_float: true
    embed-resources: true
    code-fold: true
    code-summary: "Code anzeigen"
---

```{r = packets, include=FALSE}
library(tidyverse)
library(tidymodels)
library(explore)
library(ranger)
library(corrplot)
```

# Aufgabenstellung und Daten verstehen

In dieser Arbeit soll untersucht werden, wie sich verschiedene Faktoren auf die Schlafqualität auswirken. Dabei geht es nicht nur darum, ob sich diese Faktoren auswirken, sondern auch wie stark ihr Einfluss ist.

Dazu steht uns der Datensatz *Sleep Health and Lifestyle Dataset* zur Verfügung. Dieser Datensatz enthält Informationen über den Lebensstile und die Schlafqualität verschiedener Personen. Er ist unter folgendem Link zu finden: <https://www.kaggle.com/datasets/uom190346a/sleep-health-and-lifestyle-dataset>

Zu Beginn formulieren wir zwei Thesen, die wir mit Hilfe des Datensatzes überprüfen möchen.

**These 1: Wenig Stress und viel Körperliche Aktivität hat einen großen Einfluss auf eine gute Schlafqualität**

**These 2: Mit dem Alter nimmt die Schlafqualität ab**

Diese Thesen sollen explorativ untersucht werden. Weitere Thesen werden sich eventuell bei der Sichtung der Daten ergeben.

Im nächsten Schritt werden die Daten eingelesen.

```{r, message=FALSE}
sleep_data <- read.csv("Sleep_health_and_lifestyle_dataset.csv")
```

Schauen wir uns die Daten zunächst einmal an.

```{r, message=FALSE}
knitr::kable(head(sleep_data), caption = "Das Spaltenformat des eingelesenen Datensatzes")
```

Der Datensatz hat **`r nrow(sleep_data)`** Zeilen und **`r ncol(sleep_data)`** Spalten.

Die Variablen haben folgende Bedeutung:

| Variable | Type | Bedeutung |
|------------------------|------------------------|------------------------|
| Person.ID | int | Kennung für jede Person |
| Gender | chr | Geschlecht ("Male"/"Female") |
| Age | int | Alter |
| Occupation | chr | Beruf |
| Sleep.Duration | dbl | Anzahl der Studen, die die Person am Tag schläft |
| Quality.of.Sleep | int | Subjektive Bewertung der Schlafqualität (1-10) |
| Physical.Activity.Level | int | Tägliche Aktivität in Minuten |
| Stress.Level | int | Subjektive Bewertung des Stresslevels (1-10) |
| BMI.Category | chr | BMI Kategorie |
| Blood.Pressure | char | Blutdruck (sysolisch/diastolisch) |
| Hearth.Rate | int | Ruheherzfrequenz |
| Daily.Steps | int | Tägliche Schritte |
| Sleep.Disorder | chr | Schlafstörung (Keine, Insomnie, Schlafaqnoe) |

Zunächst verschaffen wir uns einen Überblick über die Daten.

```{r, message=FALSE}
glimpse(sleep_data)
summary(sleep_data)
```

```{r, message=FALSE}
sleep_data %>% describe()
sleep_data %>% describe_tbl()
```

*Person.ID* nummeriert lediglich die verschiedenen Personen durch und ist deshalb für uns nicht relevant. Auch die Variable *Occupation* liefert uns keine relevanten Informationen. Vor allem, da wir bereits die *Stress.Level* Variable haben. Aus diesem Grund werden wir *Person.ID* und *Occupation* später aus dem Datensatz entfernen.

Ansonsten scheint der Rest der Daten relevant und korrekt zu sein.

# Daten aufbereiten

Erstellen wir unseren finalen Datensatz und entfernen alle nicht relevanten Variableln.

```{r, message=FALSE}
final_sleep_data <- 
  sleep_data %>% 
  select(-Person.ID, -Occupation)
```

Das Geschlecht ist eine kategorschie Variable. Wandeln wird sie für eine einfachere weiterverarbeitung in einen Faktor um.

```{r, message=FALSE}
final_sleep_data$Gender <-
  as.factor(final_sleep_data$Gender)
```

Da für uns nicht relevant ist um welche Schlafstörung es sich genau handelt, geben wir nur an ab eine Schlafstörung vorhanden ist.

```{r, message=FALSE}
final_sleep_data <- 
  final_sleep_data %>% 
  mutate(Sleep.Disorder = Sleep.Disorder != "None")
```

Um die Lesbarkeit zu verbesser wandel wir die *Sleep.Discorder* Variable, zu zwei Kategorien um.

```{r, message=FALSE}
final_sleep_data$Sleep.Disorder <-
  if_else(final_sleep_data$Sleep.Disorder, "Has sleep disorder", "Has no sleep disorder") %>%
  as_factor()
```

Um die Weiterverarbeitung zu vereinfachen, wandeln wir die *BMI.Category* zu einem Faktor um. Dabei bearchten wir aber auch die Reihenfolge der Kategorien.

Dazu schauen wir uns erstmal an welche Kategorien in *BMI.Category* enthalten sind.

```{r, message=FALSE}
unique(final_sleep_data$BMI.Category)
```

Es gibt 4 Kategorien. Sortiert ergibt das also: *"Normal" \< "Normal Weight" \< "Overweight" \< "Obese"*

```{r, message=FALSE}
final_sleep_data$BMI.Category <-
  final_sleep_data$BMI.Category %>%
  factor(
    levels = c("Normal", "Normal Weight","Overweight", "Obese"),
    ordered = TRUE
    )
```

Die Variabeln *Stress.Level*, *Physical.Activity.Level* und *Daily.Steps* werden in realtive Prozentwerte umgewandelt. Dabei entspricht 0 % dem minmalen Wert im Datensatz ist und 100 Prozent der maximalen Wert im Datensatz. Diese Prozentwerte fügen wir dem Datensatz hinzu um, die Variablen besser miteinander vergleichbarer zu machen.

```{r, message=FALSE}
final_sleep_data <- 
  final_sleep_data %>%
  mutate(
    Stress.Level.Percent = 100 * (Stress.Level - min(Stress.Level)) / (max(Stress.Level) - min(Stress.Level)),
    Physical.Activity.Level.Percent = 100 * (Physical.Activity.Level - min(Physical.Activity.Level)) / (max(Physical.Activity.Level) - min(Physical.Activity.Level)),
    Daily.Steps.Percent = 100 * (Daily.Steps - min(Daily.Steps)) / (max(Daily.Steps) - min(Daily.Steps))
  ) 
```

Am Ende werfen wir noch einen kurzen Blick ins finale Datenset.

```{r, message=FALSE}
knitr::kable(head(final_sleep_data), caption = "Das Finale Datenset")
glimpse(final_sleep_data)
```

Nach dem wir das Datensetz fertig aufbereiten haben, widmen wir uns um unserer ersten These.

# Modell bilden

## Explorative Datenanalyse

### Untersuchung der ersten These

Zunächst untersuchen wie sich Stress auf die Schlafqulität auswirk. Dabei vergleichen wird die Variabel *Stress.Level* mit der Variabel *Quality.of.Sleep*.

```{r, message=FALSE}
ggplot(
  data = final_sleep_data,
  mapping = aes(x = Stress.Level, y = Quality.of.Sleep)
) +
  geom_smooth() +
  geom_count() +
  labs(
    title = "Stress und Schlafqualität",
    x = "Stresslevel (1 - 10)", 
    y = "Schlafqualität (1 - 10)"
  )
```

Die Grafik zeigt, dass die Schlafqualität mit zunehmenden Stress abnimmt.

Die Schlafqualität bleibt in einem Bereich von 4 bis 9. Wobei der Durschnitt **`r mean(final_sleep_data$Quality.of.Sleep)`** beträgt.

Bis zu einem Stresslevel von 6 bleibt die Schlafqulität somit über dem Durschnittund befindet sich relativ zum Datensatz im höheren Bereich. Ab einen Stresslevel von 6 fällt die Schlafqulität hingegen unter den Durchschnitt.

Dabei ist zu beachten, dass es sich um subjektive Daten handelt. Um eine genauers Bild zu erhalten, betrachten wir im Folgenden, wie sich Stress auf die Schlafstörungen auswirkt. Dazu betrachen wir, wie groß der Anteil der Personen ist, die an Schlafstörungen leiden.

```{r}
stress_sleep_dis <- final_sleep_data %>%
  group_by(Stress.Level) %>%
  summarise(
    percent_sleep_disorder = sum(Sleep.Disorder == "Has sleep disorder") / (sum(Sleep.Disorder == "Has no sleep disorder") + sum(Sleep.Disorder == "Has sleep disorder"))
  )

stress_sleep_dis %>%
  ggplot(mapping = aes(x = Stress.Level, y = percent_sleep_disorder)) +
  geom_col() +
  scale_x_continuous(breaks = 1:10) +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Stress und Schlafstörungen",
    subtitle = "Anzahl der Schlafstörung relativ zu den Gesamten Personen",
    x = "Stresslevel (1 - 10)",
    y = "Schlafstörungen Anteil in %"
  )
```

Wie zu erkenne ist, liegt der Anteil der Schlafstörungen bei einem Stresslevel von 1 bis 6 unter 50 Prozent. Man kann sogar einen Abfall der Schlafstörungen, bis zu einem Stresslevel von 6 erkennen. Ab dem Stresslevel von 6 steigt der Anteil der Schlafstörungen jedoch deutlich an.

Trotz des anfänglischen Rückangs kann man sagen, dass ein höheres Stresslevel mit einem erhöhten Auftreten von Schlafstörungen einhergeht. Damit bestätigen sich die vorherigen Ergebnisse.

Schauen wir uns als nächstes an wie sich Körperliche Aktivität auf die Schlafqulität auswirkt.

```{r, message=FALSE}
final_sleep_data %>%
  ggplot(
    mapping = aes(x = Physical.Activity.Level, y = Quality.of.Sleep)
  ) +
  geom_smooth() +
  geom_count(mapping = aes(color = Stress.Level)) +
  scale_x_continuous(breaks = seq(0, 100, by = 10)) +
  labs(
    title = "Körperliche Aktivität, Schlafqualität und Stress",
    x = "Täglische Körperliche Aktivität in Minuten", 
    y = "Schlafqualität (1 - 10)",
    color = "Stresslevel"
  )
```

Es zeigt sich kein eindeutiger Zusammenhang zwischen körperlicher Aktivität und Schlafqualität. Es lässt sich jedoch leichten anstiegt erkennen. Zudem sind zwei größere Außreißer scihbar. Einen bei einer guten Schlafqulität trotz Körperlicher Aktivität und einer bei schlechter Schlafqulität trotz hoher Körperlicher Aktivität. Diese habe jedoch ein hohes und niedriges Stresslevel. Die Schlafqualität ist also stark von Stresslevel beeflusst.

**Insgesamt deutet die Analyse darauf hin, dass Stress einen stärkeren Einfluss auf die Schlafqulität hat als die körperliche Aktivität.**

Um ein noch genaueres Bild zu erhalten, betrachen wim im Folgenden die Verteilung der Schlafstörungen auf die Körperliche Aktivität an.

```{r}
final_sleep_data %>%
  ggplot(
    mapping = aes(x = Physical.Activity.Level, y = Sleep.Disorder)
  ) +
  geom_boxplot() +
  scale_x_continuous(breaks = seq(0, 100, by = 10)) +
  theme(axis.title.y = element_blank()) +
  labs(
    title = "Schlafstörung und Köperliche Aktivität",
    x = "Täglische Körperliche Aktivität in Minuten"
  )
```

Man kann zu beiden Graphen sagen, dass sie eine große Spannweite haben. Somit gibt es keine klare Trennung zwichen den beiden Gruppen.

Bei Personen ohne Schlafstörung liegt der Median der täglichen körperlichen Aktivität höher als bei Peronsonen mit Schlafstörungen, was darauf hindeutet, dass erstere mehr körperliche Aktivität ausüben. Gleichzeitig ist das untere Quartil bei Personen mit Schlafstörungen höher als bei Personen ohne.

Das bedeute, dass die am wenigster aktiven Personen dennoch ein höhes Körperliche Aktivität aufweisen als weniger aktiven Personen ohne Schlafstörung.

Dies deutet darauf hin, dass die Körperliche Aktivität keinen eindeutigen Zusammenhang mit dem Auftreten von Schafstörungen zeigt.

Schauen wir zusätzlich zur Körperlichen Aktivität auch noch die Täglische Schrittzahl an.

```{r message=FALSE, warning=FALSE}
final_sleep_data %>%
  ggplot(
    mapping = aes(x = Daily.Steps, y = Quality.of.Sleep)
  ) +
  geom_smooth() +
  geom_count(mapping = aes(color = Stress.Level)) +
  labs(
    title = "Tägliche Schritte und Schlafqualität",
    x = "Tägliche Schritte", 
    y = "Schlafqualität (1 - 10)",
    color = "Stresslevel"
  )
```

Auch die Strittzahl zeigt keinen eindeutigen Zusammenhang zur Schlafqualität. Der Stärkere Auslößer scheint auch hier das Stresslevel zu sein.

Zusätzlich vergleichen wir, ob die Anzahl der Täglischen Schritte einen Zusammenhang mit Schlafstörungen hat.

```{r}
final_sleep_data %>%
  ggplot(
    mapping = aes(x = Daily.Steps, y = Sleep.Disorder)
  ) +
  geom_boxplot() +
  theme(axis.title.y = element_blank()) +
  labs(
    title = "Schlafstörung und Täglische Schritte",
    x = "Tägliche Schritte"
  )
```

Ähnlich wie im Diagramm *Schlafstörungen und körperliche Aktivität* weisen Personen ohne Schlafstörung eine größere Spannweite sowie ein höheren Median als Personen mit Schlafstörungen auf. Personen mit Schlafstörungen zeigen hingegen eine geringer Spannweite. Der Median liegt zwar niedriger, jedoch ist das untere Quartil höher als bei Personen ohne Schlafstörung.

Insgesamt ähnelt sich dieses Diagramm stark dem Diagramm *Schlafstörungen und körperliche Aktivität*. Lediglich der obere Quartil der Personen mit Schlafstörung fällt im Vergleich etwas niedriger aus. Trotz dieser Unterschiede lässt sich keine eindeutiger Zusammenhang zwischen der täglischen Strittzahl und dem Auftreten von Schlafsörungen erkennen.

Aus den Diagrammen ergibt sich also:

**Körperliche Aktivität scheint die Schlafqulität nicht zu beeinflussen**

Somit lässt sich die These nur zum Teil bestätigen. Wenig Stress hat einen großen Einfluss auf die Schlafqualität. Dagegen hat die Köperliche Aktivität keinen oder nur einen kleinen Einfluss auf die Schlafqualität.

**Möglichkeites besser moruk**

### Untersuchung der zweiten These

Zunächst schauen wir uns Alter und Schlaqualität an.

```{r, message=FALSE, warning=FALSE}
ggplot(
  data = final_sleep_data,
  mapping = aes(x = Age, y = Quality.of.Sleep)
) + 
  geom_smooth() +
  geom_count() +
  labs(
    title = "Alter und Schlafqualität",
    x = "Alter", y = "Schlafqualität"
  )
```

Man kann einen anstiegt der Schlafqualität mit voranschreiten des Alters erkennen. Die Steigung ist nicht linear. Im Alter von 37 bis 47 gitb es einen Rückgang. 

Somit gibt es eine leicht positve Korrelation von **`r cor(final_sleep_data$Quality.of.Sleep, final_sleep_data$Age)`**.

Schauen wird uns zudem noch an wie sich das alter auf die Schlafstörungen auswirkt.

```{r}
ggplot(
  data = final_sleep_data,
  mapping = aes(x = Age, y = Sleep.Disorder)
) +
  geom_boxplot()
```

Der Graph zeigt, dass Schlafstörungen heufiger im hohen Alter auftreten. Dies zeigt ein anderes Bild als der vorherige Graph. Dort ist die Schlaftqulität im Alter angestiegen. 

Dazu muss man aber sagen, dass es nur eine leichte positive Correlation war. Zudem ist die Schlafqulität eine subjektive Variable. Auch steigt sie nicht linear sonder hat zwichen durch einen Abfall.

Allem im alles kann man also sagen, dass der zweige Graph eindeutigere Ergebnisse liefert. Somit wiederlegt sich die These. Schlafqulität scheint im Alter schlechter zu werden. Jedoch kann man nicht sagen, dass dies ein eindeutiges Ergebniss ist.

Um ein genauere Ergebniss zu bekommen müsste man sich noch weiter Daten anschauen. Insbesondere die Daten die im hohen Alter eine gute Schlafqulität aussagen, da dies wiedersprüchen zum zweiten Graphen sind. Man könne also versuchen sich die wiedersprüchleichen Daten durch andere Faktoren zu deuten.
