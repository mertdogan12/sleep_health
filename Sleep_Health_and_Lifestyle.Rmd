---
title: "Sleep Health and Lifestyle"
author: "Mert Baki Dogan"
date: "`r Sys.Date()`"
format: 
  html: 
    toc: true
    toc_float: true
    embed-resources: true
    code-fold: true
    code-summary: "Code anzeigen"
---

```{r = packets, include=FALSE}
library(tidyverse)
library(tidymodels)
library(explore)
library(ranger)
```

# Aufgabenstellung

In dieser Arbeit soll untersucht werden, wie sich verschiedene Faktoren auf die Schlafqualität auswirken. Dabei geht es nicht nur darum, ob sich diese Faktoren auswirken, sondern auch wie stark ihr Einfluss ist.

Dazu setht und der Datensatz *Sleep Health and Lifestyle Dataset* zur Verfügung. Dieser Datensatz enthält Informationen über den Lebensstile und die Schlafqualität verschiedener Personen. Er ist unter folgendem Link zu finden: <https://www.kaggle.com/datasets/uom190346a/sleep-health-and-lifestyle-dataset>

Zu Beginn formulieren wir zwei Thesen, die wir mit Hilfe des Datensatzes überprüfen möchen.

**These 1: Wenig Stress und viel Körperliche Aktivität hat einen großen Einfluss auf eine gute Schlafqualität**

**These 2: Mit dem Alter nimmt die Schlafqualität ab**

Diese Thesen sollen regressiv untersucht werden. Weitere Thesen werden sich eventuell bei der Sichtung der Daten ergeben.

Im nächsten Schritt werden die Daten eingelesen.

```{r, message=FALSE}
sleep_data <- read.csv("Sleep_health_and_lifestyle_dataset.csv")
```

Schauen wir uns die Daten zunächst einmal an.

```{r, message=FALSE}
knitr::kable(head(sleep_data), caption = "Das Spaltenformat des eingelesenen Datensatzes")
```

Der Datensatz hat **`r nrow(sleep_data)`** Zeilen und **`r ncol(sleep_data)`** Spalten.

Die Variablen haben folgende Bedeutung:

| Variable | Type | Bedeutung |
|----|----|----|
| Person.ID | int | Kennung für jede Person |
| Gender | chr | Geschlecht ("Male"/"Female") |
| Age | int | Alter |
| Occupation | chr | Beruf |
| Sleep.Duration | dbl | Anzahl der Studen, die die Person am Tag schläft |
| Quality.of.Sleep | int | Subjektive Bewertung der Schlafqualität (1-10) |
| Physical.Activity.Level | int | Tägliche Aktivität in Minuten |
| Stress.Level | int | Subjektive Bewertung des Stresslevels (1-10) |
| BMI.Category | chr | BMI Kategorie |
| Blood.Pressure | char | Blutdruck (sysolisch/diastolisch) |
| Hearth.Rate | int | Ruheherzfrequenz |
| Daily.Steps | int | Tägliche Schritte |
| Sleep.Disorder | chr | Schlafstörung (Keine, Insomnie, Schlafaqnoe) |

Zunächst verschaffen wir uns einen Überblick über die Daten.

```{r, message=FALSE}
glimpse(sleep_data)
summary(sleep_data)
```

```{r, message=FALSE}
sleep_data %>% describe()
sleep_data %>% describe_tbl()
```

*Person.ID* nummeriert lediglich die verschiedenen Personen durch und ist deshalb für uns nicht relevant. Auch die Variable *Occupation* liefert uns keine relevanten Informationen. Vor allem, da wir bereits die *Stress.Level* Variable haben. Aus diesem Grund werden wir *Person.ID* und *Occupation* später aus dem Datensatz entfernen.

Ansonsten scheint der Rest der Daten relevant und korrekt zu sein.

# Daten aufbereiten

Erstellen wir unseren finalen Datensatz und entfernen alle nicht relevanten Variableln.

```{r, message=FALSE}
final_sleep_data <- 
  sleep_data %>% 
  select(-Person.ID, -Occupation)
```

Das Geschlecht ist eine kategorschie Variable. Wandeln wird sie für eine einfachere weiterverarbeitung in einen Faktor um.

```{r, message=FALSE}
final_sleep_data$Gender <-
  as.factor(final_sleep_data$Gender)
```

Da für uns nicht relevant ist um welche Schlafstörung es sich genau handelt, geben wir nur an ab eine Schlafstörung vorhanden ist.

```{r, message=FALSE}
final_sleep_data <- 
  final_sleep_data %>% 
  mutate(Sleep.Disorder = Sleep.Disorder != "None")
```

Um die Lesbarkeit zu verbesser wandel wir die *Sleep.Discorder* Variable, zu zwei Kategorien um.

```{r, message=FALSE}
final_sleep_data$Sleep.Disorder <-
  if_else(final_sleep_data$Sleep.Disorder, "Has sleep disorder", "Has no sleep disorder") %>%
  as_factor()
```

Um die Weiterverarbeitung zu vereinfachen, wandeln wir die *BMI.Category* zu einem Faktor um. Dabei bearchten wir aber auch die Reihenfolge der Kategorien.

Dazu schauen wir uns erstmal an welche Kategorien in *BMI.Category* enthalten sind.

```{r, message=FALSE}
unique(final_sleep_data$BMI.Category)
```

Es gibt 4 Kategorien. Sortiert ergibt das also: *"Normal" \< "Normal Weight" \< "Overweight" \< "Obese"*

```{r, message=FALSE}
final_sleep_data$BMI.Category <-
  final_sleep_data$BMI.Category %>%
  factor(levels = c("Normal", "Normal Weight","Overweight", "Obese"))
```

Am Ende werfen wir noch einen kurzen Blick ins finale Datenset.

```{r}
knitr::kable(head(final_sleep_data), caption = "Das Finale Datenset")
```

Nach dem wir das Datensetz fertig aufbereiten haben, widmen wir uns um unserer ersten These.

# Wie wirkt sich Körperliche Aktivität und Stress auf die Schlaf Qualität aus?

```{r}
percent_sleep_data <- final_sleep_data %>%
  select(Quality.of.Sleep, Stress.Level, Physical.Activity.Level, Daily.Steps) %>%
  mutate(
    Stress.Level = 100 * (Stress.Level - min(Stress.Level)) / (max(Stress.Level) - min(Stress.Level)),
    Physical.Activity.Level = 100 * (Physical.Activity.Level - min(Physical.Activity.Level)) / (max(Physical.Activity.Level) -     min(Physical.Activity.Level)),
    Daily.Steps = 100 * (Daily.Steps - min(Daily.Steps)) / (max(Daily.Steps) - min(Daily.Steps))
  ) %>%
  pivot_longer(
    cols = c(Physical.Activity.Level, Stress.Level, Daily.Steps),
    names_to = "Variable",
    values_to = "Value"
  )
```

```{r message=FALSE, warning=FALSE}
ggplot(
  data = percent_sleep_data,
  mapping = aes(x = Quality.of.Sleep, y = Value, colour = Variable)
) +
  geom_smooth()
```

# Wie verändert sich die Schlafqualität im Alter

```{r, message=FALSE, warning=FALSE}
ggplot(
  data = final_sleep_data,
  mapping = aes(x = Quality.of.Sleep, y = Age)
) + 
  geom_smooth() +
  geom_point()
```
